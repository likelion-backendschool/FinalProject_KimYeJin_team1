<!DOCTYPE html>
<html
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        xmlns:th="http://www.thymeleaf.org"
        layout:decorate="~{layout}">

<div layout:fragment="content" class="container-fluid py-4">
    <div class="row">
        <div class="col-lg-15 mb-lg-0 mb-4">
            <div class="card z-index-2 h-100">
                <div class="card-header pb-0 pt-3 bg-transparent">
                </div>
                <div class="card-body p-3">
                    <div class="chart" style="height: 100%;">
<!--                        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>-->
<!--                        <script type="text/javascript" src="/js/toastEditor.js"></script>-->
<!--                        <script type="text/javascript" src="/js/post.js"></script>-->


                        <h2>글 쓰기</h2>
                        <hr/>
<!--                        <script src="/js/post.js"></script>-->
                        <script>
                                            let PostWrite__submitDone = false;

                function SubmitForm(form) {
                    if (PostWrite__submitDone) {
                        return;
                    }

                    form.subject.value = form.subject.value.trim();

                    if (form.subject.value.length == 0) {
                        warningModal("제목을 입력해주세요.");
                        form.subject.focus();

                        return;
                    }

                    form.postTagContents.value = form.postTagContents.value.trim();

                    if (form.postTagContents.value.length == 0) {
                        warningModal("태그를 입력해주세요.");
                        form.postTagContents.focus();

                        return;
                    }

                    const editor = $(form).find(".toast-ui-editor").data("data-toast-editor");
                    const markdown = editor.getMarkdown().trim();
                    const html = editor.getHTML().trim();

                    form.content.value = markdown;
                    form.contentHtml.value = html;

                    if (form.content.value.length == 0 || form.contentHtml.value.length == 0) {
                        warningModal("내용을 입력해주세요");
                        editor.focus();
                        return;
                    }

                    form.submit();
                    PostWrite__submitDone = true;
                }
                        </script>
                        <form th:action="@{/post/write}" th:object="${postDto}" method="post" onsubmit="SubmitForm(this); return false;">
<!--                            <div th:replace="post/form_errors :: formErrorsFragment"></div>-->

                            <div class="mb-3">
                                <label for="subject" class="form-label">제목</label>
                                <input type="text" th:field="*{subject}" class="form-control">
                            </div>
<!--                            <div class="mb-3">-->
<!--                                <label for="content" class="form-label">내용</label>-->
<!--                                <textarea th:field="*{content}" class="form-control" rows="10"></textarea>-->
<!--                            </div>-->
                            <div class="toast-ui-editor" toast-ui-editor--height="800px"></div>
                            <div class="mt-1">
                                <input type="hidden" th:field="*{content}" rows="3"
                                       class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 mt-1 block w-full sm:text-sm border-gray-300 rounded-md"
                                       placeholder="내용을 입력하세요.">
                                <input type="hidden" th:field="*{contentHTML}" rows="3"
                                       class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 mt-1 block w-full sm:text-sm border-gray-300 rounded-md"
                                       placeholder="내용을 입력하세요.">
                            </div>
                            <div class="mb-3">
                                <label for="hashTagsStr" class="form-label">해시태그</label>
                                <input type="text" th:field="*{hashTagsStr}" class="form-control">
                            </div>
                            <button type="button" class="btn btn-outline-primary" onclick="SubmitForm(this); return false;">글쓰기</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <th:block th:replace="fragment/toastEditor :: toastEditor"></th:block>

</div>

</html>